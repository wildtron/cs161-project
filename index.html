<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <script type="x-shader/x-vertex" id="vshader">
        attribute vec3 aPosition;
        attribute vec3 aNormal;
        attribute vec2 aTexCoords;

        uniform mat4 uModel;
        uniform mat4 uView;
        uniform mat4 uProjection;
        uniform mat4 uNormal;

        varying vec2 vTexCoords;
        varying vec3 vNormal;
        varying vec3 vPosition;

        void main() {
            gl_Position = uProjection * uView * uModel * vec4(aPosition,1.0);

            vec3 vertexPosition = vec3(uModel * vec4(aPosition,1.0));
            vec3 corrected_aNormal = vec3(uNormal * vec4(aNormal,1.0));

            vPosition =  vertexPosition;
            vNormal = corrected_aNormal;
            vTexCoords = aTexCoords;
        }
    </script>
    <script type="x-shader/x-fragment" id="fshader">
        precision mediump float;

        uniform sampler2D uSampler;

        uniform vec3 uLightDirection;
        uniform vec3 uEyePosition;

        uniform vec3 uMaterialAmbient;
        uniform vec3 uLightAmbient;

        uniform vec3 uMaterialDiffuse;
        uniform vec3 uLightDiffuse;

        uniform vec3 uMaterialSpecular;
        uniform vec3 uLightSpecular;

        uniform float uShininess;

        uniform bool uEnableAmbient;
        uniform bool uEnableDiffuse;
        uniform bool uEnableSpecular;

        varying vec2 vTexCoords;
        varying vec3 vNormal;
        varying vec3 vPosition;

        void main() {
            vec3 ambientColor = vec3(0.0,0.0,0.0);
            vec3 diffuseColor = vec3(0.0,0.0,0.0);
            vec3 specularColor = vec3(0.0,0.0,0.0);
            vec3 normalized_aNormal = normalize(vNormal);

            vec3 normalized_uLightDirection = normalize(uLightDirection);
            vec3 eyeDirection = uEyePosition - vPosition;
            vec3 normalized_eyeDirection = normalize(eyeDirection);
            vec3 reflectDirection = reflect(normalized_uLightDirection,normalized_aNormal);
            vec3 normalized_reflectDirection = normalize(reflectDirection);

            //ambient
            if(uEnableAmbient) {
                ambientColor = uLightAmbient * uMaterialAmbient;
            }

            //diffuse
            if(uEnableDiffuse) {
                float lambertCoefficient = max(dot(-normalized_uLightDirection,normalized_aNormal),0.0);
                diffuseColor =  uLightDiffuse * uMaterialDiffuse * lambertCoefficient;
            }

            //specular
            if(uEnableSpecular) {
                float specularCoefficient = max(dot(normalized_reflectDirection,normalized_eyeDirection),0.0);
                specularCoefficient = pow(specularCoefficient,uShininess);
                specularColor =  uLightSpecular * uMaterialSpecular * specularCoefficient;
                //specularColor = vec3(1.0,1.0,1.0) * specularCoefficient;
            }
            vec4 textureColor = texture2D(uSampler, vTexCoords);
            vec4 finalColor = vec4(textureColor.rgb * (diffuseColor),textureColor.a);
            gl_FragColor = finalColor;

        }
    </script>
</head>
<body onload="main()">
    <canvas id="canvas"></canvas>
    <script type="text/javascript" src="js/utils.js"></script>
    <script type="text/javascript" src="js/gl-matrix-min.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
</body>
</html>
